<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>웹소켓으로 채팅 프로그램 만들기 | TIL</title>
    <meta name="description" content="Today I Learned">
    
    
    <link rel="preload" href="/TIL/assets/css/0.styles.ac85a3b9.css" as="style"><link rel="preload" href="/TIL/assets/js/app.f4f4f010.js" as="script"><link rel="preload" href="/TIL/assets/js/13.ca260f20.js" as="script"><link rel="preload" href="/TIL/assets/js/4.cc23a868.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.5b5795b5.js"><link rel="prefetch" href="/TIL/assets/js/11.5c24ae0e.js"><link rel="prefetch" href="/TIL/assets/js/12.47fc06e4.js"><link rel="prefetch" href="/TIL/assets/js/14.0b306e5d.js"><link rel="prefetch" href="/TIL/assets/js/15.a68f305f.js"><link rel="prefetch" href="/TIL/assets/js/16.0b893d1e.js"><link rel="prefetch" href="/TIL/assets/js/17.68855fb6.js"><link rel="prefetch" href="/TIL/assets/js/18.f081acd8.js"><link rel="prefetch" href="/TIL/assets/js/19.f8a8c8fb.js"><link rel="prefetch" href="/TIL/assets/js/2.f92558c5.js"><link rel="prefetch" href="/TIL/assets/js/20.9dfa8f78.js"><link rel="prefetch" href="/TIL/assets/js/21.4b7b68a1.js"><link rel="prefetch" href="/TIL/assets/js/22.f9cf6af1.js"><link rel="prefetch" href="/TIL/assets/js/23.5a7cbf82.js"><link rel="prefetch" href="/TIL/assets/js/24.bc53d059.js"><link rel="prefetch" href="/TIL/assets/js/25.27776767.js"><link rel="prefetch" href="/TIL/assets/js/3.5eca98ed.js"><link rel="prefetch" href="/TIL/assets/js/5.f07b10b1.js"><link rel="prefetch" href="/TIL/assets/js/6.23104b37.js"><link rel="prefetch" href="/TIL/assets/js/7.67a00e58.js"><link rel="prefetch" href="/TIL/assets/js/8.5456a703.js"><link rel="prefetch" href="/TIL/assets/js/9.65bcd2ca.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.ac85a3b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">TIL</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/ByeongUkChoi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://unhosted.tistory.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/ByeongUkChoi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://unhosted.tistory.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>HOME</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>개발일기</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JAVA</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>컴퓨터공학</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>PYTHON</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/TIL/6.PYTHON/1.웹소켓.html" class="active sidebar-link">웹소켓으로 채팅 프로그램 만들기</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>딥러닝_머신러닝</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>마피아게임</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="웹소켓으로-채팅-프로그램-만들기"><a href="#웹소켓으로-채팅-프로그램-만들기" aria-hidden="true" class="header-anchor">#</a> 웹소켓으로 채팅 프로그램 만들기</h1> <p>cilent : javascript</p> <p>server: python2</p> <p><strong>순서</strong></p> <ol start="0"><li>소켓 준비</li> <li>WebSocket Handshake (클라이언트 -&gt; 서버 : 핸드쉐이킹 요청, 서버 -&gt; 클라이언트 : 핸드 쉐이킹 응답)</li> <li>데이터 프레임 교환</li> <li>Ping and Pong</li> <li>Closing the connection</li></ol> <p><strong>1. WebSocket Handshake</strong></p> <p>클라이언트 -&gt; 서버 : 핸드쉐이킹 요청</p> <p>GET /chat HTTP/1.1
Host: example.com:8000
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== ( 키 값 )
Sec-WebSocket-Version: 13</p> <p>서버 -&gt; 클라이언트 : 핸드 쉐이킹 응답</p> <p>HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= ( 변환된 키 값 )</p> <p>키 값에 &quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;를 더해 준 후 SHA-1 hash  변환</p> <p><strong>2. 데이터 프레임 교환</strong></p> <h3 id="웹소켓-데이터-프레임"><a href="#웹소켓-데이터-프레임" aria-hidden="true" class="header-anchor">#</a> 웹소켓 데이터 프레임</h3> <div class="language- extra-class"><pre class="language-text"><code>+---------------------------------------------------------------+
0(byte)         1               2               3             
0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
4               5               6               7             
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
8               9               10              11            
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
12              13              14              15
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+
</code></pre></div><p>MSB (최상위 비트)<br> <strong>FIN</strong> : 마지막 메세지<br>
FIN = 0 ( 마지막 메세지가 아님. 서버에서 뒤에 메세지들 까지 수신)<br>
FIN = 1 ( 마지막 메세지. 전체 메세지 수신 완료 메세지 처리)<br> <strong>RSV1-3</strong> : 0. 사용안함. 확장 프로토콜 또는 추후를 위해 할당<br> <strong>opcode</strong> : 뒤의 Payload 데이터의 포멧을 나타냄</p> <ul><li>0x0 denotes a continuation frame            ( 연속 프레임. 데이터가 여러 조각으로 분리된 경우 )</li> <li>0x1 denotes a text frame                               ( 문자열 데이터 )</li> <li>0x2 denotes a binary frame                          ( 2진 데이터 )</li> <li>0x3-7 are reserved for further non-control frames (아무런 의미 없음)</li> <li>0x8 denotes a connection close                 ( 접속 종료 )</li> <li>0x9 denotes a ping</li> <li>0xA denotes a pong</li> <li>0xB-F are reserved for further control frames (아무런 의미 없음)</li></ul> <p><strong>MASK</strong> : 메세지 인코딩 여부. 
클라이언트 -&gt; 서버 : MASK = 1 ( 항상 마스킹 되어야 함. 아니면 연결 종료)<br>
서버 -&gt; 클라이언트 : MASK = 0 ( 항상 데이터는 마스킹 되지 않은 상태)<br> <strong>Payload len</strong> : 9-15bit를 unsigned integer로 읽음.<br>
Payload len &gt;= 125 : Payload의 길이 = 9-15bit의 unsigned integer 값 (Extended payload length 존재 X)<br>
Payload len == 126 : Payload의 길이 = 16-31bit의 unsigned integer 값 (16bits) 
Payload len == 127 : Payload의 길이 = 16-79bit의 unsigned integer 값 (64bits)<br>
Extended payload length : Payload len 값 에 따라 존재하지 않거나 2bytes,8bytes를 가짐</p> <p><strong>Masging-key</strong> : 
MASK가 1일때(클라이언트 -&gt; 서버 전송 시 데이터가 마스킹 된 경우) 보내는 데이터를 마스크 할 때 사용하는 키.</p> <p>(MASK가 0일 경우 존재하지 않음)<br>
데이터를 마스크 처리 하거나 복원 할 때 사용<br>
원본data-octet ^ 마스킹key-octet = 마스킹된data-octet<br>
마스킹data-octet ^ 마스킹key-octet = 원본data-octet<br>
j = i MOD 4<br>
transformed-octet-i = original-octet-i XOR masking-key-octet-j<br> <strong>Payload Data</strong> : 보내는 데이터. Payload len 이나, Extended payload length 값에 해당하는 길이를 가짐</p> <h3 id="server-python2-select사용"><a href="#server-python2-select사용" aria-hidden="true" class="header-anchor">#</a> Server (python2) (select사용)</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># -*- coding:utf-8-*-</span>

<span class="token keyword">import</span> socket
<span class="token keyword">import</span> select
<span class="token keyword">import</span> re
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> struct
<span class="token keyword">import</span> sys

<span class="token keyword">from</span> signal <span class="token keyword">import</span> signal<span class="token punctuation">,</span> SIGPIPE<span class="token punctuation">,</span> SIG_DFL
signal<span class="token punctuation">(</span>SIGPIPE<span class="token punctuation">,</span>SIG_DFL<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>input_list<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># payload가 126일때 extended_payload_len을 2바이트 가지는데 이때 최대 값이 65535</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">65535</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&gt;Q'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> data
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">125</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&gt;H'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> data
        <span class="token keyword">else</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> data
        <span class="token comment"># 클라이언트 리스트 모두에게 send ( 서버가 아니고 sys.stdin도 아닌 )</span>
        <span class="token keyword">for</span> client <span class="token keyword">in</span> <span class="token punctuation">[</span>sock <span class="token keyword">for</span> sock <span class="token keyword">in</span> input_list <span class="token keyword">if</span> <span class="token operator">not</span> sock <span class="token operator">==</span> server <span class="token operator">and</span> <span class="token operator">not</span> sock <span class="token operator">==</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">]</span> <span class="token punctuation">:</span> client<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;send ERROR : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">recv</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first_byte <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    second_byte <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    FIN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xFF</span> <span class="token operator">&amp;</span> first_byte<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span>
    opcode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x0F</span> <span class="token operator">&amp;</span> first_byte<span class="token punctuation">)</span>
    mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xFF</span> <span class="token operator">&amp;</span> second_byte<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span>
    payload_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x7F</span> <span class="token operator">&amp;</span> second_byte<span class="token punctuation">)</span>

    <span class="token keyword">if</span> opcode <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token comment"># payload_len 구하기</span>
        <span class="token keyword">if</span> payload_len <span class="token operator">==</span> <span class="token number">126</span> <span class="token punctuation">:</span> payload_len <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack_from<span class="token punctuation">(</span><span class="token string">'&gt;H'</span><span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> payload_len <span class="token operator">==</span> <span class="token number">127</span> <span class="token punctuation">:</span> payload_len <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack_from<span class="token punctuation">(</span><span class="token string">'&gt;Q'</span><span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># masking_key 구해서 masking된것 복구하기 ( mask가 1일 경우에만 존재 )</span>
        <span class="token keyword">if</span> mask <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            masking_key <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            masked_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> <span class="token punctuation">[</span>masked_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> masking_key<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>masked_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">return</span> opcode<span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>b<span class="token string">'\x00'</span><span class="token punctuation">)</span> <span class="token comment"># opcode 값을 넘김</span>
    <span class="token keyword">print</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>             <span class="token comment"># 받은거 콘솔에 출력용</span>
    <span class="token keyword">return</span> opcode<span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handshake</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        request <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
        m <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'[\\w\\W]+Sec-WebSocket-Key: (.+)\r\n[\\w\\W]+\r\n\r\n'</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span>
        key <span class="token operator">=</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'</span>
        response <span class="token operator">=</span> <span class="token string">&quot;HTTP/1.1 101 Switching Protocols\r\n&quot;</span><span class="token operator">+</span>\
                <span class="token string">&quot;Upgrade: websocket\r\n&quot;</span><span class="token operator">+</span>\
                <span class="token string">&quot;Connection: Upgrade\r\n&quot;</span><span class="token operator">+</span>\
                <span class="token string">&quot;Sec-WebSocket-Accept: %s\r\n&quot;</span><span class="token operator">+</span>\
                <span class="token string">&quot;\r\n&quot;</span>
        r <span class="token operator">=</span> response <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>r<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">&quot;---handshake end!---&quot;</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;handshake ERROR : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handler_client</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        opcode<span class="token punctuation">,</span> data <span class="token operator">=</span> recv<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
        <span class="token keyword">if</span> opcode <span class="token operator">==</span> <span class="token number">0x8</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">'close frame received'</span>
            input_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">elif</span> opcode <span class="token operator">==</span> <span class="token number">0x1</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token comment"># input_list.remove(client)</span>
                <span class="token comment"># return</span>
                <span class="token keyword">print</span> <span class="token string">&quot;emty data&quot;</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># msg = data.decode('utf-8', 'ignore')</span>
                msg <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> client_info <span class="token keyword">if</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> client<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; :: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>
                <span class="token comment"># 클라이언트 리스트를 매개변수로 보냄</span>
                send<span class="token punctuation">(</span>input_list<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
        <span class="token keyword">else</span> <span class="token punctuation">:</span> <span class="token keyword">print</span> <span class="token string">'frame not handled : opcode='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' len='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;handler ERROR : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">&quot;disconnected&quot;</span>
        input_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>client<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">start_server</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># host = 'localhost'</span>
        <span class="token comment"># port = 8765</span>
        <span class="token keyword">global</span> server
        <span class="token keyword">global</span> input_list
        <span class="token keyword">global</span> client_info
        server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        input_list <span class="token operator">=</span> <span class="token punctuation">[</span>server<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">]</span>    <span class="token comment"># sys.stdin은 쉘창에서 입력받은것 때문에 넣어줌</span>
        client_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">print</span> <span class="token string">&quot;Server : &quot;</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token comment"># select 함수는 관찰될 read, write, except 리스트가 인수로 들어가며</span>
            <span class="token comment"># 응답받은 read, write, except 리스트가 반환된다.</span>
            <span class="token comment"># input_list 내에 있는 소켓들에 데이터가 들어오는지 감시한다.</span>
            <span class="token comment"># 다르게 말하면 input_list 내에 읽을 준비가 된 소켓이 있는지 감시한다.</span>
            input_ready<span class="token punctuation">,</span> write_ready<span class="token punctuation">,</span> except_ready <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span>input_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token comment"># 응답받은 read 리스트 처리</span>
            <span class="token keyword">for</span> ir <span class="token keyword">in</span> input_ready<span class="token punctuation">:</span>
                <span class="token comment"># 클라이언트가 접속했으면 처리함</span>
                <span class="token keyword">if</span> ir <span class="token operator">==</span> server<span class="token punctuation">:</span>
                    client<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span> <span class="token string">&quot;connected : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
                    handshake<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
                    <span class="token comment"># input_list에 추가함으로써 데이터가 들어오는 것을 감시함</span>
                    input_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
                    client_info<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 쉘 창 입력. 입력된 데이터 클라이언트에게 전송</span>
                <span class="token keyword">elif</span> ir <span class="token operator">==</span> sys<span class="token punctuation">.</span>stdin <span class="token punctuation">:</span> send<span class="token punctuation">(</span>input_list<span class="token punctuation">,</span> <span class="token string">&quot;Administrator :: &quot;</span> <span class="token operator">+</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 클라이언트소켓에 데이터가 들어왔으면</span>
                <span class="token keyword">else</span> <span class="token punctuation">:</span> handler_client<span class="token punctuation">(</span>ir<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;start_server ERROR &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
        <span class="token comment"># 부드럽게 종료하기</span>
        <span class="token keyword">print</span> <span class="token string">&quot;키보드 강제 종료&quot;</span>
        server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

start_server<span class="token punctuation">(</span><span class="token string">'192.168.10.1(아이피주소)'</span><span class="token punctuation">,</span><span class="token number">8765</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>(multi thread 사용)</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># -*- coding:utf-8-*-</span>

<span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> re
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> struct
<span class="token keyword">import</span> sys

<span class="token keyword">from</span> signal <span class="token keyword">import</span> signal<span class="token punctuation">,</span> SIGPIPE<span class="token punctuation">,</span> SIG_DFL
signal<span class="token punctuation">(</span>SIGPIPE<span class="token punctuation">,</span>SIG_DFL<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>client_tuple<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># payload가 126일때 extended_payload_len을 2바이트 가지는데 이때 최대 값이 65535</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">65535</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&gt;Q'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> data
        <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">125</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'&gt;H'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> data
        <span class="token keyword">else</span> <span class="token punctuation">:</span> frame <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token string">'\x81'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> data
        <span class="token comment"># 클라이언트 리스트 모두에게 send</span>
        <span class="token keyword">for</span> client <span class="token keyword">in</span> client_tuple <span class="token punctuation">:</span> client<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;send ERROR : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">recv</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first_byte <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    second_byte <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    FIN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xFF</span> <span class="token operator">&amp;</span> first_byte<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span>
    opcode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x0F</span> <span class="token operator">&amp;</span> first_byte<span class="token punctuation">)</span>
    mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xFF</span> <span class="token operator">&amp;</span> second_byte<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">7</span>
    payload_len <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x7F</span> <span class="token operator">&amp;</span> second_byte<span class="token punctuation">)</span>

    <span class="token keyword">if</span> opcode <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token comment"># payload_len 구하기</span>
        <span class="token keyword">if</span> payload_len <span class="token operator">==</span> <span class="token number">126</span> <span class="token punctuation">:</span> payload_len <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack_from<span class="token punctuation">(</span><span class="token string">'&gt;H'</span><span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">elif</span> payload_len <span class="token operator">==</span> <span class="token number">127</span> <span class="token punctuation">:</span> payload_len <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack_from<span class="token punctuation">(</span><span class="token string">'&gt;Q'</span><span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># masking_key 구해서 masking된것 복구하기 ( mask가 1일 경우에만 존재 )</span>
        <span class="token keyword">if</span> mask <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            masking_key <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            masked_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> <span class="token punctuation">[</span>masked_data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> masking_key<span class="token punctuation">[</span>i<span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>masked_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>payload_len<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">return</span> opcode<span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>b<span class="token string">'\x00'</span><span class="token punctuation">)</span> <span class="token comment"># opcode 값을 넘김</span>
    <span class="token keyword">print</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>             <span class="token comment"># 받은거 콘솔에 출력용        </span>
    <span class="token keyword">return</span> opcode<span class="token punctuation">,</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">handshake</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    request <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'[\\w\\W]+Sec-WebSocket-Key: (.+)\r\n[\\w\\W]+\r\n\r\n'</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span>
    key <span class="token operator">=</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'258EAFA5-E914-47DA-95CA-C5AB0DC85B11'</span>
    response <span class="token operator">=</span> <span class="token string">&quot;HTTP/1.1 101 Switching Protocols\r\n&quot;</span><span class="token operator">+</span>\
            <span class="token string">&quot;Upgrade: websocket\r\n&quot;</span><span class="token operator">+</span>\
            <span class="token string">&quot;Connection: Upgrade\r\n&quot;</span><span class="token operator">+</span>\
            <span class="token string">&quot;Sec-WebSocket-Accept: %s\r\n&quot;</span><span class="token operator">+</span>\
            <span class="token string">&quot;\r\n&quot;</span>
    r <span class="token operator">=</span> response <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">&quot;---handshake end!---&quot;</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

clients <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment"># (클라이언트, addr) 리스트</span>
threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment"># (스레드 , addr) 리스트</span>

<span class="token keyword">def</span> <span class="token function">handler_client</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    handshakestat <span class="token operator">=</span> handshake<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> handshakestat <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token keyword">return</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            opcode<span class="token punctuation">,</span> data <span class="token operator">=</span> recv<span class="token punctuation">(</span>client<span class="token punctuation">)</span>
            <span class="token keyword">if</span> opcode <span class="token operator">==</span> <span class="token number">0x8</span><span class="token punctuation">:</span>
                clients<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token keyword">elif</span> opcode <span class="token operator">==</span> <span class="token number">0x1</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># return</span>
                    <span class="token keyword">print</span> <span class="token string">&quot;emty data&quot;</span>
                    <span class="token keyword">continue</span>
                <span class="token comment"># msg = data.decode('utf-8', 'ignore')</span>
                msg <span class="token operator">=</span> addr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' :: '</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'ignore'</span><span class="token punctuation">)</span>
                <span class="token comment"># 클라이언트 리스트를 매개변수로 보냄</span>
                sendstat <span class="token operator">=</span> send<span class="token punctuation">(</span>clients<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> sendstat <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token keyword">print</span> <span class="token string">'sendstat err'</span>
            <span class="token keyword">else</span> <span class="token punctuation">:</span> <span class="token keyword">print</span> <span class="token string">'frame not handled : opcode='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' len='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;handler ERROR : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">&quot;disconnected&quot;</span>
    client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">start_server</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        server <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>  <span class="token comment"># 기본값</span>
        <span class="token comment"># SO_REUSEADDR 이미 사용된 주소를 재사용</span>
        <span class="token comment"># 소켓이 종료 되도 커널단에서 해당 소켓을 바인딩해서 사용 중</span>
        <span class="token comment"># SO_REUSEADDR 옵션을 이용하여 기존에 바인딩된 주소를 재사용</span>
        server<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span>
        server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span> <span class="token string">&quot;Server : &quot;</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token comment"># clients와 threads의 addr을 비교하여 thread를 죽임 새로운 접근이 있어야만 동작</span>
            <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token punctuation">[</span>th <span class="token keyword">for</span> th <span class="token keyword">in</span> threads <span class="token keyword">if</span> <span class="token operator">not</span> th<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> clients<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
                threads<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>t<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>threads<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">print</span> <span class="token string">&quot;쓰레드 없음&quot;</span>
            client<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">&quot;connected : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
            thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target <span class="token operator">=</span> handler_client<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            clients<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;start_server ERROR &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">&quot;키보드 강제 종료&quot;</span>
        server<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

start_server<span class="token punctuation">(</span><span class="token string">'192.168.0.1(아이피주소)'</span><span class="token punctuation">,</span><span class="token number">8765</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="client-javascript"><a href="#client-javascript" aria-hidden="true" class="header-anchor">#</a> Client (javascript)</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>채팅<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>


<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;chatArea&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;overflow-y: auto; height: 379px;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-inline&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;msg&quot;</span> onkeypress<span class="token operator">=</span><span class="token string">&quot;if( event.keyCode==13 ){sendMsg();}&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-default&quot;</span> onclick<span class="token operator">=</span><span class="token string">&quot;sendMsg()&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;전송&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token number">0</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;DOMContentLoaded&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ws <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> ws<span class="token punctuation">.</span>readyState <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;WebSocket&quot;</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// alert(&quot;WebSocket is supported by your Browser!&quot;);</span>
            ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://192.168.10.1(아이피주소):8765&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;connected&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;/gi</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&gt;/gi</span><span class="token punctuation">,</span> <span class="token string">&quot;&gt; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#chatArea&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>data <span class="token operator">+</span> <span class="token string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#chatArea&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollTop</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#chatArea&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            window<span class="token punctuation">.</span><span class="token function-variable function">onbeforeunload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WebSocket NOT supported by your Browser!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">ChatAreaResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> div2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'chatArea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// div2.style.width = window.innerWidth - 200 + 'px';</span>
        div2<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span><span class="token number">200</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">ChatAreaResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 브라우저 크기가 변할 시 동적으로 사이즈를 조절해야 하는경우</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> ChatAreaResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>구동 화면</p> <p><img src="https://t1.daumcdn.net/cfile/tistory/99641F3D5AB8866A4B" alt></p> <p>출처 : <a href="https://developer.mozilla.org/ko/docs/WebSockets/Writing_WebSocket_servers" target="_blank" rel="noopener noreferrer">웹소켓 설명<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>참고: <a href="http://lanian-windrunner.blogspot.kr/2013/08/python-websocket-server.html" target="_blank" rel="noopener noreferrer">websocket 프레임,<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="http://lanian-windrunner.blogspot.kr/2013/08/python-websocket-server.html" target="_blank" rel="noopener noreferrer"> js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://scienceofdata.tistory.com/entry/Python-select-%ED%95%A8%EC%88%98%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%97%90%EC%BD%94-%EC%84%9C%EB%B2%84%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%98%88%EC%A0%9C" target="_blank" rel="noopener noreferrer">파이썬<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="http://scienceofdata.tistory.com/entry/Python-select-%ED%95%A8%EC%88%98%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%97%90%EC%BD%94-%EC%84%9C%EB%B2%84%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8-%EC%98%88%EC%A0%9C" target="_blank" rel="noopener noreferrer">select 함수<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>티스토리블로그 : https://unhosted.tistory.com/15?category=735973</p> <p><div id="disqus_thread"></div></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/TIL/assets/js/13.ca260f20.js" defer></script><script src="/TIL/assets/js/4.cc23a868.js" defer></script><script src="/TIL/assets/js/app.f4f4f010.js" defer></script>
  </body>
</html>
